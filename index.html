<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Продвинутый генератор цветовых палитр</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/vue-router@4"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }

        :root {
            --bg-light: #f8f9fa;
            --bg-dark: #1a1a1a;
            --text-light: #333;
            --text-dark: #f0f0f0;
            --card-light: #ffffff;
            --card-dark: #2d2d2d;
            --primary: #4361ee;
            --primary-hover: #3a56d4;
            --success: #06d6a0;
            --warning: #ffd166;
            --danger: #ef476f;
            --border-radius: 12px;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            --shadow-dark: 0 4px 20px rgba(0, 0, 0, 0.2);
            --transition: all 0.3s ease;
        }

        body {
            transition: background-color 0.3s, color 0.3s;
            min-height: 100vh;
        }

        .light-theme {
            background-color: var(--bg-light);
            color: var(--text-light);
        }

        .dark-theme {
            background-color: var(--bg-dark);
            color: var(--text-dark);
        }

        #app {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .navbar {
            background-color: var(--card-light);
            box-shadow: var(--shadow);
            padding: 0 20px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .dark-theme .navbar {
            background-color: var(--card-dark);
            box-shadow: var(--shadow-dark);
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 70px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
            text-decoration: none;
        }

        .nav-links {
            display: flex;
            gap: 5px;
        }

        .nav-link {
            padding: 12px 20px;
            text-decoration: none;
            color: inherit;
            font-weight: 600;
            border-radius: 8px;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-link:hover, .nav-link.active {
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--primary);
        }

        .dark-theme .nav-link:hover, .dark-theme .nav-link.active {
            background-color: rgba(67, 97, 238, 0.2);
        }

        .theme-toggle {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: inherit;
            padding: 10px;
            border-radius: 50%;
            transition: background-color 0.2s;
            margin-left: 10px;
        }

        .theme-toggle:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .dark-theme .theme-toggle:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .main-content {
            flex: 1;
            max-width: 1400px;
            width: 100%;
            margin: 0 auto;
            padding: 30px 20px;
        }

        .page-title {
            font-size: 32px;
            margin-bottom: 30px;
            color: var(--primary);
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .control-card {
            background-color: var(--card-light);
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        .dark-theme .control-card {
            background-color: var(--card-dark);
            box-shadow: var(--shadow-dark);
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-hover);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background-color: transparent;
            color: inherit;
            border: 2px solid var(--primary);
        }

        .btn-secondary:hover {
            background-color: rgba(67, 97, 238, 0.1);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
        }

        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .color-picker-container {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .color-preview {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            border: 2px solid #ddd;
            cursor: pointer;
        }

        .color-input {
            flex: 1;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 16px;
            font-family: monospace;
        }

        .dark-theme .color-input {
            border-color: #555;
            background-color: #333;
            color: white;
        }

        select, input[type="range"] {
            padding: 10px 16px;
            border-radius: 8px;
            border: 1px solid #ccc;
            background-color: white;
            font-size: 16px;
            width: 100%;
        }

        .dark-theme select, .dark-theme input[type="range"] {
            border-color: #555;
            background-color: #333;
            color: white;
        }

        .palette-container {
            margin-bottom: 40px;
        }

        .palette {
            display: flex;
            height: 200px;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        .color-card {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 20px;
            position: relative;
            cursor: pointer;
            transition: transform 0.2s, filter 0.2s;
        }

        .color-card:hover {
            transform: translateY(-4px);
            filter: brightness(1.05);
            z-index: 1;
        }

        .color-info {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .color-values {
            background-color: rgba(255, 255, 255, 0.9);
            padding: 8px 12px;
            border-radius: 6px;
            color: #333;
            font-family: monospace;
            font-size: 14px;
        }

        .dark-theme .color-values {
            background-color: rgba(0, 0, 0, 0.7);
            color: #f0f0f0;
        }

        .color-actions {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            background-color: rgba(255, 255, 255, 0.9);
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            font-size: 16px;
            color: #333;
        }

        .action-btn:hover {
            transform: scale(1.1);
            background-color: white;
        }

        .dark-theme .action-btn {
            background-color: rgba(0, 0, 0, 0.7);
            color: #f0f0f0;
        }

        .pinned {
            background-color: gold !important;
            color: #333 !important;
        }

        .contrast-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .contrast-item {
            padding: 15px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .contrast-ratio {
            font-weight: bold;
            font-size: 18px;
            min-width: 70px;
        }

        .contrast-rating {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .rating-aaa {
            background-color: #06d6a0;
            color: white;
        }

        .rating-aa {
            background-color: #118ab2;
            color: white;
        }

        .rating-fail {
            background-color: #ef476f;
            color: white;
        }

        .color-wheel-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .color-wheel {
            width: 300px;
            height: 300px;
            border-radius: 50%;
            background: conic-gradient(
                from 0deg,
                #ff0000 0deg,
                #ffff00 60deg,
                #00ff00 120deg,
                #00ffff 180deg,
                #0000ff 240deg,
                #ff00ff 300deg,
                #ff0000 360deg
            );
            position: relative;
        }

        .wheel-point {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            transform: translate(-50%, -50%);
            cursor: pointer;
        }

        .export-options {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }

        .export-format {
            padding: 12px 20px;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            flex: 1;
            min-width: 200px;
        }

        .export-format:hover, .export-format.active {
            border-color: var(--primary);
            background-color: rgba(67, 97, 238, 0.1);
        }

        .code-block {
            background-color: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            overflow-x: auto;
            margin-bottom: 20px;
            max-height: 300px;
            overflow-y: auto;
        }

        .copy-code-btn {
            align-self: flex-start;
        }

        /* Библиотека */
        .library-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
        }

        .palette-card {
            background-color: var(--card-light);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            cursor: pointer;
        }

        .dark-theme .palette-card {
            background-color: var(--card-dark);
            box-shadow: var(--shadow-dark);
        }

        .palette-card:hover {
            transform: translateY(-5px);
        }

        .palette-card-colors {
            display: flex;
            height: 100px;
        }

        .palette-card-color {
            flex: 1;
        }

        .palette-card-info {
            padding: 20px;
        }

        .palette-card-title {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 18px;
        }

        .palette-card-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 10px;
        }

        .tag {
            padding: 4px 10px;
            background-color: rgba(67, 97, 238, 0.1);
            border-radius: 20px;
            font-size: 12px;
            color: var(--primary);
        }

        .search-bar {
            margin-bottom: 30px;
            display: flex;
            gap: 15px;
        }

        .search-input {
            flex: 1;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 16px;
        }

        .dark-theme .search-input {
            border-color: #555;
            background-color: #333;
            color: white;
        }

        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 16px 24px;
            background-color: var(--success);
            color: white;
            border-radius: 8px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1000;
            animation: fadeInOut 3s ease-in-out;
        }

        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateY(20px); }
            15% { opacity: 1; transform: translateY(0); }
            85% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(20px); }
        }

        .footer {
            text-align: center;
            padding: 20px;
            font-size: 14px;
            color: #666;
            border-top: 1px solid #eee;
            margin-top: 40px;
        }

        .dark-theme .footer {
            color: #aaa;
            border-top-color: #444;
        }

        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }
            
            .palette {
                flex-direction: column;
                height: auto;
            }
            
            .color-card {
                height: 120px;
            }
            
            .controls-grid {
                grid-template-columns: 1fr;
            }
            
            .library-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body class="light-theme">
    <div id="app">
        <nav class="navbar">
            <div class="nav-container">
                <router-link to="/" class="logo">
                    <i class="fas fa-palette"></i>
                    <span>ColorLab Pro</span>
                </router-link>
                
                <div class="nav-links">
                    <router-link to="/" class="nav-link">
                        <i class="fas fa-home"></i> Главная
                    </router-link>
                    <router-link to="/generator" class="nav-link">
                        <i class="fas fa-magic"></i> Генератор
                    </router-link>
                    <router-link to="/library" class="nav-link">
                        <i class="fas fa-book"></i> Библиотека
                    </router-link>
                    <router-link to="/export" class="nav-link">
                        <i class="fas fa-download"></i> Экспорт
                    </router-link>
                </div>
                
                <button class="theme-toggle" @click="toggleTheme">
                    <i :class="darkTheme ? 'fas fa-sun' : 'fas fa-moon'"></i>
                </button>
            </div>
        </nav>

        <main class="main-content">
            <router-view></router-view>
        </main>

        <footer class="footer">
            <p>Практика 28: Продвинутый генератор цветовых палитр. Все права защищены.</p>
        </footer>
    </div>

    <script>
        const { createApp, ref, computed, reactive, watch, onMounted } = Vue;
        const { createRouter, createWebHashHistory } = VueRouter;

        const HomePage = {
            template: `
                <div>
                    <h1 class="page-title">Добро пожаловать в ColorLab Pro</h1>
                    <p style="margin-bottom: 30px; font-size: 18px;">Профессиональный инструмент для работы с цветовыми палитрами</p>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px;">
                        <div class="control-card">
                            <h2 class="card-title"><i class="fas fa-magic"></i> Генерация палитр</h2>
                            <p>Создавайте гармоничные цветовые палитры с использованием различных алгоритмов</p>
                        </div>
                        
                        <div class="control-card">
                            <h2 class="card-title"><i class="fas fa-chart-line"></i> Анализ доступности</h2>
                            <p>Проверяйте контрастность цветов по стандарту WCAG для создания доступных интерфейсов</p>
                        </div>
                        
                        <div class="control-card">
                            <h2 class="card-title"><i class="fas fa-book"></i> Библиотека палитр</h2>
                            <p>Сохраняйте и организуйте ваши палитры в именованные коллекции</p>
                        </div>
                        
                        <div class="control-card">
                            <h2 class="card-title"><i class="fas fa-download"></i> Экспорт</h2>
                            <p>Экспортируйте палитры в различные форматы для использования в проектах</p>
                        </div>
                    </div>
                </div>
            `
        };

        // Компонент страницы генератора
const GeneratorPage = {
    setup(props, { emit }) {
        const colorCount = ref(5);
        const colorFormat = ref('hex');
        const palette = ref([]);
        const showNotification = ref(false);
        const copiedColor = ref('');
        const baseColor = ref('#838456'); // Начальный цвет из примера
        const paletteType = ref('analogous');
        const mood = ref('balanced');
        const colorPoints = ref([]);
        const contrastAnalysis = ref(null);
        
        // Генерация случайного цвета
        const generateRandomColor = () => {
            const letters = '0123456789ABCDEF';
            let color = '#';
            for (let i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        };
        
        // HEX to RGB
        const hexToRgb = (hex) => {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? 
                `rgb(${parseInt(result[1], 16)}, ${parseInt(result[2], 16)}, ${parseInt(result[3], 16)})` : 
                '';
        };
        
        // HEX to HSL
        const hexToHsl = (hex) => {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            let r = parseInt(result[1], 16) / 255;
            let g = parseInt(result[2], 16) / 255;
            let b = parseInt(result[3], 16) / 255;
            
            const max = Math.max(r, g, b);
            const min = Math.min(r, g, b);
            let h, s, l = (max + min) / 2;
            
            if (max === min) {
                h = s = 0;
            } else {
                const d = max - min;
                s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                switch (max) {
                    case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                    case g: h = (b - r) / d + 2; break;
                    case b: h = (r - g) / d + 4; break;
                }
                h /= 6;
            }
            
            return {
                h: Math.round(h * 360),
                s: Math.round(s * 100),
                l: Math.round(l * 100)
            };
        };
        
        // HSL to HEX
        const hslToHex = (h, s, l) => {
            l /= 100;
            const a = s * Math.min(l, 1 - l) / 100;
            const f = n => {
                const k = (n + h / 30) % 12;
                const color = l - a * Math.max(Math.min(k - 3, 9 - k, 1), -1);
                return Math.round(255 * color).toString(16).padStart(2, '0');
            };
            return `#${f(0)}${f(8)}${f(4)}`;
        };
        
        // Генерация различных типов палитр
        const generatePalette = () => {
            const baseHsl = hexToHsl(baseColor.value);
            const newPalette = [];
            
            // Сохраняем закреплённые цвета
            const pinnedColors = palette.value.filter(c => c.pinned);
            
            for (let i = 0; i < colorCount.value; i++) {
                // Пропускаем закреплённые цвета
                if (i < pinnedColors.length) {
                    newPalette.push(pinnedColors[i]);
                    continue;
                }
                
                let h = baseHsl.h;
                let s = baseHsl.s;
                let l = baseHsl.l;
                
                // Настройка по настроению
                switch (mood.value) {
                    case 'calm':
                        s = Math.max(20, s - 20);
                        l = Math.min(80, l + 10);
                        break;
                    case 'energetic':
                        s = Math.min(100, s + 20);
                        l = 50 + Math.random() * 20;
                        break;
                    case 'professional':
                        s = Math.max(10, s - 30);
                        l = 30 + Math.random() * 40;
                        break;
                    case 'vibrant':
                        s = 80 + Math.random() * 20;
                        l = 50 + Math.random() * 20;
                        break;
                    case 'balanced':
                        // Для сбалансированного сохраняем оригинальные значения
                        break;
                }
                
                // Генерация по типу палитры
                switch (paletteType.value) {
                    case 'analogous':
                        h = (baseHsl.h + (i * 30) - 60) % 360;
                        break;
                    case 'monochromatic':
                        h = baseHsl.h;
                        l = 20 + (i * (60 / colorCount.value));
                        s = s - 10 + (i * (20 / colorCount.value));
                        break;
                    case 'triadic':
                        h = (baseHsl.h + (i * 120)) % 360;
                        break;
                    case 'complementary':
                        h = i % 2 === 0 ? baseHsl.h : (baseHsl.h + 180) % 360;
                        l = i < 2 ? l : l + (i % 2 === 0 ? -10 : 10);
                        break;
                    case 'tetradic':
                        h = (baseHsl.h + (i * 90)) % 360;
                        break;
                    case 'split-complementary':
                        h = i === 0 ? baseHsl.h : (baseHsl.h + (i * 150)) % 360;
                        break;
                }
                
                const hex = hslToHex(h, s, l);
                const rgb = hexToRgb(hex);
                const hsl = `hsl(${h}, ${s}%, ${l}%)`;
                
                newPalette.push({
                    hex,
                    rgb,
                    hsl,
                    pinned: false,
                    h, s, l
                });
            }
            
            // Обновляем точки на цветовом круге
            updateColorWheelPoints(newPalette);
            
            palette.value = newPalette;
            
            // Выполняем анализ контрастности
            analyzeContrast();
            
            saveToLocalStorage();
        };
        
        // Обновление точек на цветовом круге
        const updateColorWheelPoints = (palette) => {
            colorPoints.value = palette.map(color => {
                const hue = color.h;
                const radius = 120;
                const angle = (hue * Math.PI) / 180;
                const x = radius * Math.cos(angle);
                const y = radius * Math.sin(angle);
                
                return {
                    x: 150 + x,
                    y: 150 + y,
                    color: color.hex
                };
            });
        };
        
        // Расчёт контрастности по стандарту WCAG
        const calculateContrast = (color1, color2) => {
            const getLuminance = (hex) => {
                const rgb = hex.match(/#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})/i);
                if (!rgb) return 0;
                
                const [r, g, b] = [rgb[1], rgb[2], rgb[3]].map(channel => {
                    const normalized = parseInt(channel, 16) / 255;
                    return normalized <= 0.03928 
                        ? normalized / 12.92 
                        : Math.pow((normalized + 0.055) / 1.055, 2.4);
                });
                
                return 0.2126 * r + 0.7152 * g + 0.0722 * b;
            };
            
            const l1 = getLuminance(color1);
            const l2 = getLuminance(color2);
            const lighter = Math.max(l1, l2);
            const darker = Math.min(l1, l2);
            
            return (lighter + 0.05) / (darker + 0.05);
        };
        
        // Получение рейтинга контрастности
        const getContrastRating = (ratio) => {
            if (ratio >= 7) {
                return { 
                    rating: 'AAA', 
                    class: 'rating-aaa',
                    description: 'Отлично - высший уровень доступности',
                    acceptable: true,
                    icon: 'fa-check-circle',
                    color: '#06d6a0'
                };
            }
            if (ratio >= 4.5) {
                return { 
                    rating: 'AA', 
                    class: 'rating-aa',
                    description: 'Хорошо - соответствует стандартам',
                    acceptable: true,
                    icon: 'fa-check-circle',
                    color: '#118ab2'
                };
            }
            if (ratio >= 3) {
                return { 
                    rating: 'A (крупный текст)', 
                    class: 'rating-aa',
                    description: 'Минимально для крупного текста (≥24px)',
                    acceptable: true,
                    icon: 'fa-exclamation-triangle',
                    color: '#ffd166'
                };
            }
            return { 
                rating: 'Недостаточно', 
                class: 'rating-fail',
                description: 'Не соответствует стандартам доступности WCAG',
                acceptable: false,
                icon: 'fa-times-circle',
                color: '#ef476f'
            };
        };
        
        // Полный анализ контрастности палитры
        const analyzeContrast = () => {
            if (!palette.value || palette.value.length < 2) {
                contrastAnalysis.value = null;
                return;
            }
            
            const analysis = {
                pairs: [],
                overallRating: 'good',
                recommendations: [],
                statistics: {
                    totalPairs: 0,
                    aaaPairs: 0,
                    aaPairs: 0,
                    minimalPairs: 0,
                    failedPairs: 0,
                    minContrast: 100,
                    maxContrast: 0
                }
            };
            
            // Анализируем все возможные пары
            for (let i = 0; i < palette.value.length; i++) {
                for (let j = i + 1; j < palette.value.length; j++) {
                    const color1 = palette.value[i].hex;
                    const color2 = palette.value[j].hex;
                    const ratio = calculateContrast(color1, color2);
                    const rating = getContrastRating(ratio);
                    
                    analysis.pairs.push({
                        color1: { hex: color1, index: i },
                        color2: { hex: color2, index: j },
                        ratio: ratio,
                        rating: rating
                    });
                    
                    // Обновляем статистику
                    analysis.statistics.totalPairs++;
                    if (ratio >= 7) analysis.statistics.aaaPairs++;
                    else if (ratio >= 4.5) analysis.statistics.aaPairs++;
                    else if (ratio >= 3) analysis.statistics.minimalPairs++;
                    else analysis.statistics.failedPairs++;
                    
                    analysis.statistics.minContrast = Math.min(analysis.statistics.minContrast, ratio);
                    analysis.statistics.maxContrast = Math.max(analysis.statistics.maxContrast, ratio);
                }
            }
            
            // Определяем общий рейтинг
            const failureRate = analysis.statistics.failedPairs / analysis.statistics.totalPairs;
            if (failureRate > 0.5) {
                analysis.overallRating = 'poor';
            } else if (failureRate > 0.2) {
                analysis.overallRating = 'fair';
            } else if (analysis.statistics.aaaPairs / analysis.statistics.totalPairs > 0.5) {
                analysis.overallRating = 'excellent';
            } else {
                analysis.overallRating = 'good';
            }
            
            // Генерируем рекомендации
            generateRecommendations(analysis);
            
            contrastAnalysis.value = analysis;
        };
        
        // Генерация рекомендаций по улучшению
        const generateRecommendations = (analysis) => {
            const recommendations = [];
            
            // Рекомендации на основе статистики
            if (analysis.statistics.failedPairs > 0) {
                const failureRate = (analysis.statistics.failedPairs / analysis.statistics.totalPairs * 100).toFixed(1);
                
                recommendations.push({
                    type: 'warning',
                    icon: 'fa-exclamation-triangle',
                    title: 'Низкая контрастность',
                    message: `${analysis.statistics.failedPairs} из ${analysis.statistics.totalPairs} пар цветов (${failureRate}%) имеют недостаточный контраст`,
                    actions: [
                        'Измените тип палитры на комплементарную или триадическую',
                        'Увеличьте насыщенность через настройку "Настроение"',
                        'Используйте автоматическое улучшение контрастности'
                    ]
                });
            }
            
            // Рекомендации на основе настроек
            if (paletteType.value === 'analogous' && analysis.statistics.failedPairs > 0) {
                recommendations.push({
                    type: 'advice',
                    icon: 'fa-lightbulb',
                    title: 'Попробуйте другой тип палитры',
                    message: 'Аналогичные палитры часто имеют низкий контраст между цветами',
                    actions: [
                        'Комплементарная: максимальный контраст',
                        'Триадическая: сбалансированный контраст',
                        'Тетрадическая: разнообразие контрастов'
                    ]
                });
            }
            
            if (mood.value === 'calm' && analysis.statistics.failedPairs > 0) {
                recommendations.push({
                    type: 'advice',
                    icon: 'fa-palette',
                    title: 'Настроение влияет на контраст',
                    message: 'Настроение "Спокойное" снижает насыщенность цветов',
                    actions: [
                        'Используйте "Энергичное" для большей насыщенности',
                        'Попробуйте "Яркое" для максимального контраста',
                        'Или "Профессиональное" для сбалансированных тонов'
                    ]
                });
            }
            
            // Рекомендации на основе конкретных проблемных пар
            const problematicPairs = analysis.pairs.filter(p => !p.rating.acceptable).slice(0, 3);
            if (problematicPairs.length > 0) {
                recommendations.push({
                    type: 'specific',
                    icon: 'fa-search',
                    title: 'Проблемные сочетания',
                    message: 'Эти пары требуют особого внимания:',
                    pairs: problematicPairs.map(p => ({
                        colors: `Цвет ${p.color1.index + 1} → Цвет ${p.color2.index + 1}`,
                        contrast: `${p.ratio.toFixed(2)}:1`,
                        rating: p.rating.rating
                    }))
                });
            }
            
            // Позитивные рекомендации
            if (analysis.statistics.aaaPairs > 0) {
                recommendations.push({
                    type: 'success',
                    icon: 'fa-check-circle',
                    title: 'Отличные сочетания найдены!',
                    message: `${analysis.statistics.aaaPairs} пар соответствуют высшему стандарту AAA`,
                    actions: [
                        'Используйте эти цвета для основного текста',
                        'Эти сочетания идеальны для важного контента'
                    ]
                });
            }
            
            analysis.recommendations = recommendations;
        };
        
        // Автоматическое улучшение контрастности
        const autoFixContrast = () => {
            const newPalette = [...palette.value];
            let improvements = 0;
            
            // Улучшаем контраст между соседними цветами
            for (let i = 0; i < newPalette.length; i++) {
                for (let j = i + 1; j < newPalette.length; j++) {
                    if (newPalette[i].pinned || newPalette[j].pinned) continue;
                    
                    const currentContrast = calculateContrast(newPalette[i].hex, newPalette[j].hex);
                    
                    if (currentContrast < 4.5) {
                        const hsl1 = { h: newPalette[i].h, s: newPalette[i].s, l: newPalette[i].l };
                        const hsl2 = { h: newPalette[j].h, s: newPalette[j].s, l: newPalette[j].l };
                        
                        // Увеличиваем разницу в яркости
                        if (Math.abs(hsl1.l - hsl2.l) < 30) {
                            if (hsl1.l > hsl2.l) {
                                hsl1.l = Math.min(85, hsl1.l + 20);
                                hsl2.l = Math.max(15, hsl2.l - 20);
                            } else {
                                hsl1.l = Math.max(15, hsl1.l - 20);
                                hsl2.l = Math.min(85, hsl2.l + 20);
                            }
                            
                            newPalette[i].hex = hslToHex(hsl1.h, hsl1.s, hsl1.l);
                            newPalette[i].l = hsl1.l;
                            newPalette[i].hsl = `hsl(${hsl1.h}, ${hsl1.s}%, ${hsl1.l}%)`;
                            
                            newPalette[j].hex = hslToHex(hsl2.h, hsl2.s, hsl2.l);
                            newPalette[j].l = hsl2.l;
                            newPalette[j].hsl = `hsl(${hsl2.h}, ${hsl2.s}%, ${hsl2.l}%)`;
                            
                            improvements++;
                        }
                    }
                }
            }
            
            if (improvements > 0) {
                palette.value = newPalette;
                updateColorWheelPoints(palette.value);
                analyzeContrast();
                saveToLocalStorage();
                
                // Показываем уведомление
                showNotification.value = true;
                copiedColor.value = `Улучшено ${improvements} цветовых пар`;
                setTimeout(() => {
                    showNotification.value = false;
                }, 3000);
            }
        };
        
        // Создание доступной палитры
        const generateAccessiblePalette = () => {
            paletteType.value = 'complementary';
            mood.value = 'vibrant';
            generatePalette();
        };
        
        // Копирование в буфер обмена
        const copyToClipboard = async (color) => {
            const textToCopy = colorFormat.value === 'hex' ? color.hex : 
                             colorFormat.value === 'rgb' ? color.rgb : color.hsl;
            
            try {
                await navigator.clipboard.writeText(textToCopy);
                copiedColor.value = textToCopy;
                showNotification.value = true;
                
                setTimeout(() => {
                    showNotification.value = false;
                }, 3000);
            } catch (err) {
                console.error('Ошибка копирования: ', err);
            }
        };
        
        // Переключение закрепления
        const togglePin = (color) => {
            color.pinned = !color.pinned;
            saveToLocalStorage();
        };
        
        // Регенерация одного цвета
        const regenerateColor = (index) => {
            if (palette.value[index].pinned) return;
            
            const newColor = generateRandomColor();
            const rgb = hexToRgb(newColor);
            const hsl = hexToHsl(newColor);
            
            palette.value[index] = {
                hex: newColor,
                rgb,
                hsl: `hsl(${hsl.h}, ${hsl.s}%, ${hsl.l}%)`,
                pinned: false,
                ...hsl
            };
            
            updateColorWheelPoints(palette.value);
            analyzeContrast();
            saveToLocalStorage();
        };
        
        // Получение контрастного цвета для текста
        const getContrastColor = (hexColor) => {
            const rgb = hexToRgb(hexColor).match(/\d+/g);
            if (!rgb) return '#333';
            
            const [r, g, b] = rgb.map(Number);
            const brightness = (r * 299 + g * 587 + b * 114) / 1000;
            return brightness > 128 ? '#333333' : '#ffffff';
        };
        
        // Сохранение в localStorage
        const saveToLocalStorage = () => {
            const data = {
                palette: palette.value,
                colorCount: colorCount.value,
                colorFormat: colorFormat.value,
                baseColor: baseColor.value,
                paletteType: paletteType.value,
                mood: mood.value
            };
            localStorage.setItem('colorPaletteData', JSON.stringify(data));
        };
        
        // Загрузка из localStorage
        const loadFromLocalStorage = () => {
            const savedData = localStorage.getItem('colorPaletteData');
            
            if (savedData) {
                const data = JSON.parse(savedData);
                colorCount.value = data.colorCount || 5;
                colorFormat.value = data.colorFormat || 'hex';
                baseColor.value = data.baseColor || '#838456';
                paletteType.value = data.paletteType || 'analogous';
                mood.value = data.mood || 'balanced';
                
                if (data.palette && data.palette.length > 0) {
                    palette.value = data.palette;
                    if (palette.value.length !== colorCount.value) {
                        generatePalette();
                    } else {
                        updateColorWheelPoints(palette.value);
                        analyzeContrast();
                    }
                    return;
                }
            }
            
            generatePalette();
        };
        
        // Инициализация
        onMounted(() => {
            loadFromLocalStorage();
        });
        
        // Наблюдатели
        watch([colorCount, baseColor, paletteType, mood], () => {
            generatePalette();
        });
        
        return {
            colorCount,
            colorFormat,
            palette,
            showNotification,
            copiedColor,
            baseColor,
            paletteType,
            mood,
            colorPoints,
            contrastAnalysis,
            generatePalette,
            regenerateColor,
            copyToClipboard,
            togglePin,
            calculateContrast,
            getContrastRating,
            autoFixContrast,
            generateAccessiblePalette,
            getContrastColor
        };
    },
    template: `
        <div>
            <h1 class="page-title">Генератор палитр</h1>
            
            <div class="controls-grid">
                <!-- Настройки генерации -->
                <div class="control-card">
                    <h2 class="card-title"><i class="fas fa-sliders-h"></i> Настройки генерации</h2>
                    <div style="margin-bottom: 15px;">
                        <label>Базовый цвет:</label>
                        <div class="color-picker-container">
                            <input type="color" v-model="baseColor" class="color-preview">
                            <input type="text" v-model="baseColor" class="color-input" maxlength="7">
                        </div>
                        <div style="font-size: 12px; color: #666; margin-top: 5px;">
                            Текущий: {{ baseColor }}
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label>Тип палитры:</label>
                        <select v-model="paletteType">
                            <option value="analogous">Аналогичная</option>
                            <option value="monochromatic">Монохромная</option>
                            <option value="triadic">Триада</option>
                            <option value="complementary">Комплементарная</option>
                            <option value="tetradic">Тетрадическая</option>
                            <option value="split-complementary">Раздельно-комплементарная</option>
                        </select>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label>Настроение:</label>
                        <select v-model="mood">
                            <option value="balanced">Сбалансированное</option>
                            <option value="calm">Спокойное</option>
                            <option value="energetic">Энергичное</option>
                            <option value="professional">Профессиональное</option>
                            <option value="vibrant">Яркое</option>
                        </select>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label>Количество цветов: {{ colorCount }}</label>
                        <input type="range" v-model="colorCount" min="3" max="7" step="1">
                    </div>
                    
                    <button class="btn btn-primary" @click="generatePalette">
                        <i class="fas fa-random"></i> Сгенерировать палитру
                    </button>
                </div>
                
                <!-- Анализ контрастности -->
                <div class="control-card">
                    <h2 class="card-title"><i class="fas fa-chart-line"></i> Анализ контрастности</h2>
                    <p style="font-size: 14px; color: #666; margin-bottom: 15px;">
                        Стандарты WCAG: 
                        <span style="color: #06d6a0; font-weight: 600;">AAA ≥ 7:1</span> | 
                        <span style="color: #118ab2; font-weight: 600;">AA ≥ 4.5:1</span> | 
                        <span style="color: #ef476f; font-weight: 600;">Недостаточно &lt; 4.5:1</span>
                    </p>
                    
                    <!-- Статистика контрастности -->
                    <div v-if="contrastAnalysis" style="margin-bottom: 20px;">
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                            <div style="background: #f8f9fa; padding: 12px; border-radius: 6px;">
                                <div style="font-size: 12px; color: #666;">Всего пар:</div>
                                <div style="font-size: 20px; font-weight: 600;">{{ contrastAnalysis.statistics.totalPairs }}</div>
                            </div>
                            <div style="background: #f8f9fa; padding: 12px; border-radius: 6px;">
                                <div style="font-size: 12px; color: #666;">Недостаточно:</div>
                                <div style="font-size: 20px; font-weight: 600; color: #ef476f;">
                                    {{ contrastAnalysis.statistics.failedPairs }}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Примеры контрастности -->
                    <div class="contrast-grid" style="margin-bottom: 20px;">
                        <div v-if="palette.length >= 2" 
                             class="contrast-item" 
                             :style="{ 
                                 backgroundColor: palette[0].hex, 
                                 color: getContrastColor(palette[0].hex) 
                             }">
                            <div style="flex: 1;">
                                <div style="font-size: 24px; font-weight: 600;">
                                    {{ calculateContrast(palette[0].hex, palette[1].hex).toFixed(2) }}:1
                                </div>
                                <div style="font-size: 12px; opacity: 0.8;">
                                    Цвет 1 → Цвет 2
                                </div>
                            </div>
                            <div class="contrast-rating" :class="getContrastRating(calculateContrast(palette[0].hex, palette[1].hex)).class">
                                {{ getContrastRating(calculateContrast(palette[0].hex, palette[1].hex)).rating }}
                            </div>
                        </div>
                        
                        <div v-if="palette.length >= 3" 
                             class="contrast-item" 
                             :style="{ 
                                 backgroundColor: palette[1].hex, 
                                 color: getContrastColor(palette[1].hex) 
                             }">
                            <div style="flex: 1;">
                                <div style="font-size: 24px; font-weight: 600;">
                                    {{ calculateContrast(palette[1].hex, palette[2].hex).toFixed(2) }}:1
                                </div>
                                <div style="font-size: 12px; opacity: 0.8;">
                                    Цвет 2 → Цвет 3
                                </div>
                            </div>
                            <div class="contrast-rating" :class="getContrastRating(calculateContrast(palette[1].hex, palette[2].hex)).class">
                                {{ getContrastRating(calculateContrast(palette[1].hex, palette[2].hex)).rating }}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Рекомендации -->
                    <div v-if="contrastAnalysis && contrastAnalysis.recommendations.length > 0" 
                         style="margin-top: 20px;">
                        <h3 style="margin-bottom: 10px; font-size: 16px;">
                            <i class="fas fa-lightbulb"></i> Рекомендации
                        </h3>
                        <div style="max-height: 300px; overflow-y: auto;">
                            <div v-for="(rec, idx) in contrastAnalysis.recommendations" 
                                 :key="idx" 
                                 style="margin-bottom: 15px; padding: 15px; border-radius: 8px; 
                                        background-color: #f8f9fa; border-left: 4px solid #ddd;">
                                <div style="display: flex; align-items: flex-start; gap: 10px;">
                                    <i :class="['fas', rec.icon]" 
                                       :style="{ 
                                           color: rec.type === 'warning' ? '#ef476f' : 
                                                  rec.type === 'success' ? '#06d6a0' : '#4361ee',
                                           fontSize: '18px',
                                           marginTop: '2px'
                                       }"></i>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; margin-bottom: 5px; color: #333;">
                                            {{ rec.title }}
                                        </div>
                                        <div style="font-size: 14px; color: #666; margin-bottom: 8px;">
                                            {{ rec.message }}
                                        </div>
                                        <div v-if="rec.actions" style="font-size: 13px; color: #555;">
                                            <div v-for="(action, actionIdx) in rec.actions" 
                                                 :key="actionIdx" 
                                                 style="margin-bottom: 3px;">
                                                • {{ action }}
                                            </div>
                                        </div>
                                        <div v-if="rec.pairs" style="font-size: 13px; color: #555; margin-top: 8px;">
                                            <div v-for="(pair, pairIdx) in rec.pairs" 
                                                 :key="pairIdx" 
                                                 style="margin-bottom: 3px; display: flex; justify-content: space-between;">
                                                <span>{{ pair.colors }}</span>
                                                <span style="font-weight: 600;">{{ pair.contrast }} ({{ pair.rating }})</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Быстрые действия -->
                    <div style="margin-top: 20px;">
                        <h3 style="font-size: 16px; margin-bottom: 10px;">Быстрые исправления:</h3>
                        <div class="btn-group">
                            <button class="btn btn-small btn-secondary" @click="paletteType = 'complementary'">
                                <i class="fas fa-exchange-alt"></i> Комплементарная
                            </button>
                            <button class="btn btn-small btn-secondary" @click="mood = 'energetic'">
                                <i class="fas fa-bolt"></i> Энергичное
                            </button>
                            <button class="btn btn-small btn-secondary" @click="autoFixContrast">
                                <i class="fas fa-magic"></i> Авто-исправление
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Цветовой круг -->
            <div class="control-card">
                <h2 class="card-title"><i class="fas fa-circle"></i> Цветовой круг</h2>
                <p style="color: #666; margin-bottom: 15px; font-size: 14px;">
                    Цвета вашей палитры на цветовом круге. Разные типы палитр создают разные геометрические формы.
                </p>
                <div class="color-wheel-container">
                    <div class="color-wheel">
                        <div v-for="(point, index) in colorPoints" :key="index" 
                             class="wheel-point" 
                             :style="{
                                 left: point.x + 'px',
                                 top: point.y + 'px',
                                 backgroundColor: point.color,
                                 border: '3px solid white',
                                 boxShadow: '0 0 0 1px rgba(0,0,0,0.3)',
                                 cursor: 'pointer'
                             }"
                             @click="copyToClipboard(palette[index])"
                             :title="'Цвет ' + (index + 1) + ': ' + palette[index].hex + ' (клик для копирования)'">
                            <div style="position: absolute; top: -25px; left: 50%; transform: translateX(-50%); 
                                        background: white; padding: 2px 6px; border-radius: 4px; font-size: 12px;
                                        white-space: nowrap; box-shadow: 0 2px 4px rgba(0,0,0,0.2); font-weight: 600;">
                                {{ index + 1 }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Палитра -->
            <div class="palette-container">
                <h2 class="card-title"><i class="fas fa-palette"></i> Цветовая палитра</h2>
                <div class="palette">
                    <div 
                        class="color-card" 
                        v-for="(color, index) in palette" 
                        :key="index"
                        :style="{ backgroundColor: color.hex }"
                        @click="copyToClipboard(color)"
                    >
                        <div class="color-info">
                            <div class="color-values" :style="{ 
                                color: getContrastColor(color.hex),
                                backgroundColor: 'rgba(255,255,255,0.9)',
                                padding: '8px 12px',
                                borderRadius: '6px',
                                fontFamily: 'monospace'
                            }">
                                {{ colorFormat === 'hex' ? color.hex : colorFormat === 'rgb' ? color.rgb : color.hsl }}
                            </div>
                            <div class="color-actions">
                                <button 
                                    class="action-btn" 
                                    :class="{ pinned: color.pinned }"
                                    @click.stop="togglePin(color)"
                                    :title="color.pinned ? 'Открепить цвет' : 'Закрепить цвет'"
                                    :style="{ 
                                        color: getContrastColor(color.hex),
                                        backgroundColor: 'rgba(255,255,255,0.9)'
                                    }"
                                >
                                    <i class="fas fa-thumbtack"></i>
                                </button>
                                <button 
                                    class="action-btn" 
                                    @click.stop="regenerateColor(index)"
                                    title="Сгенерировать новый цвет"
                                    :style="{ 
                                        color: getContrastColor(color.hex),
                                        backgroundColor: 'rgba(255,255,255,0.9)'
                                    }"
                                >
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                        </div>
                        <div style="margin-top: auto;">
                            <div style="font-size: 12px; background: rgba(255,255,255,0.9); padding: 4px 8px; 
                                        border-radius: 4px; margin-top: 10px; color: #333;">
                                <div>Контраст с текстом: {{ calculateContrast(color.hex, getContrastColor(color.hex)).toFixed(2) }}:1</div>
                                <div style="font-size: 11px; margin-top: 2px;">
                                    HSL: {{ color.h }}°, {{ color.s }}%, {{ color.l }}%
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="btn-group" style="margin-top: 20px;">
                    <button class="btn btn-secondary" @click="colorFormat = 'hex'"
                            :class="{ active: colorFormat === 'hex' }">
                        HEX
                    </button>
                    <button class="btn btn-secondary" @click="colorFormat = 'rgb'"
                            :class="{ active: colorFormat === 'rgb' }">
                        RGB
                    </button>
                    <button class="btn btn-secondary" @click="colorFormat = 'hsl'"
                            :class="{ active: colorFormat === 'hsl' }">
                        HSL
                    </button>
                    <button class="btn btn-primary" @click="generateAccessiblePalette">
                        <i class="fas fa-universal-access"></i> Доступная палитра
                    </button>
                    <button class="btn btn-primary" @click="autoFixContrast">
                        <i class="fas fa-magic"></i> Улучшить контрастность
                    </button>
                </div>
            </div>
            
            <!-- Уведомление -->
            <div v-if="showNotification" class="notification">
                <i class="fas fa-check-circle"></i> Скопировано: {{ copiedColor }}
            </div>
        </div>
    `
};

        const LibraryPage = {
            setup() {
                const savedPalettes = ref([]);
                const searchQuery = ref('');
                const filterTag = ref('all');
                const newPaletteName = ref('');
                const newPaletteTags = ref('');
                
                const loadPalettes = () => {
                    const saved = localStorage.getItem('savedPalettes');
                    savedPalettes.value = saved ? JSON.parse(saved) : [
                        {
                            id: 1,
                            name: 'Океанская глубина',
                            colors: ['#4361ee', '#3a0ca3', '#7209b7', '#f72585', '#4cc9f0'],
                            tags: ['природа', 'спокойствие'],
                            date: '2024-01-15'
                        },
                        {
                            id: 2,
                            name: 'Осенний лес',
                            colors: ['#d4a276', '#bc6c25', '#606c38', '#283618', '#fefae0'],
                            tags: ['природа', 'тёплые'],
                            date: '2024-01-14'
                        },
                        {
                            id: 3,
                            name: 'Технологии',
                            colors: ['#03045e', '#0077b6', '#00b4d8', '#90e0ef', '#caf0f8'],
                            tags: ['профессиональный', 'холодные'],
                            date: '2024-01-13'
                        }
                    ];
                };
                
                const saveCurrentPalette = () => {
                    const currentPalette = JSON.parse(localStorage.getItem('colorPaletteData'))?.palette;
                    if (!currentPalette || !newPaletteName.value) return;
                    
                    const newPalette = {
                        id: Date.now(),
                        name: newPaletteName.value,
                        colors: currentPalette.map(c => c.hex),
                        tags: newPaletteTags.value.split(',').map(t => t.trim()).filter(t => t),
                        date: new Date().toISOString().split('T')[0]
                    };
                    
                    savedPalettes.value.unshift(newPalette);
                    localStorage.setItem('savedPalettes', JSON.stringify(savedPalettes.value));
                    
                    newPaletteName.value = '';
                    newPaletteTags.value = '';
                };
                
                const deletePalette = (id) => {
                    savedPalettes.value = savedPalettes.value.filter(p => p.id !== id);
                    localStorage.setItem('savedPalettes', JSON.stringify(savedPalettes.value));
                };
                
                const loadPalette = (palette) => {
                    const colorData = palette.colors.map(hex => ({
                        hex,
                        rgb: hexToRgb(hex),
                        pinned: false
                    }));
                    
                    const data = {
                        palette: colorData,
                        colorCount: colorData.length,
                        colorFormat: 'hex',
                        baseColor: colorData[0].hex
                    };
                    
                    localStorage.setItem('colorPaletteData', JSON.stringify(data));
                    window.location.hash = '/generator';
                };
                
                const filteredPalettes = computed(() => {
                    return savedPalettes.value.filter(palette => {
                        const matchesSearch = palette.name.toLowerCase().includes(searchQuery.value.toLowerCase()) ||
                                             palette.tags.some(tag => tag.toLowerCase().includes(searchQuery.value.toLowerCase()));
                        
                        const matchesTag = filterTag.value === 'all' || 
                                          palette.tags.includes(filterTag.value);
                        
                        return matchesSearch && matchesTag;
                    });
                });
              
                const allTags = computed(() => {
                    const tags = new Set();
                    savedPalettes.value.forEach(palette => {
                        palette.tags.forEach(tag => tags.add(tag));
                    });
                    return Array.from(tags);
                });
                
                onMounted(() => {
                    loadPalettes();
                });
                
                return {
                    savedPalettes,
                    searchQuery,
                    filterTag,
                    newPaletteName,
                    newPaletteTags,
                    filteredPalettes,
                    allTags,
                    saveCurrentPalette,
                    deletePalette,
                    loadPalette
                };
            },
            template: `
                <div>
                    <h1 class="page-title">Библиотека палитр</h1>
                    
                    <!-- Форма сохранения -->
                    <div class="control-card" style="margin-bottom: 30px;">
                        <h2 class="card-title"><i class="fas fa-save"></i> Сохранить текущую палитру</h2>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label>Название палитры:</label>
                                <input type="text" v-model="newPaletteName" class="search-input" 
                                       placeholder="Введите название">
                            </div>
                            <div>
                                <label>Теги (через запятую):</label>
                                <input type="text" v-model="newPaletteTags" class="search-input" 
                                       placeholder="например: природа, спокойствие">
                            </div>
                        </div>
                        <button class="btn btn-primary" @click="saveCurrentPalette" :disabled="!newPaletteName">
                            <i class="fas fa-save"></i> Сохранить в библиотеку
                        </button>
                    </div>
                    
                    <!-- Поиск и фильтрация -->
                    <div class="search-bar">
                        <input type="text" v-model="searchQuery" class="search-input" placeholder="Поиск по названию или тегам...">
                        <select v-model="filterTag" class="search-input" style="width: 200px;">
                            <option value="all">Все теги</option>
                            <option v-for="tag in allTags" :key="tag" :value="tag">{{ tag }}</option>
                        </select>
                    </div>
                    
                    <!-- Список палитр -->
                    <div class="library-container">
                        <div v-for="palette in filteredPalettes" :key="palette.id" class="palette-card" @click="loadPalette(palette)">
                            <div class="palette-card-colors">
                                <div v-for="color in palette.colors" :key="color" 
                                     class="palette-card-color" :style="{ backgroundColor: color }">
                                </div>
                            </div>
                            <div class="palette-card-info">
                                <h3 class="palette-card-title">{{ palette.name }}</h3>
                                <p style="color: #666; font-size: 14px;">Сохранено: {{ palette.date }}</p>
                                <div class="palette-card-tags">
                                    <span v-for="tag in palette.tags" :key="tag" class="tag">{{ tag }}</span>
                                </div>
                                <div style="margin-top: 15px; display: flex; gap: 10px;">
                                    <button class="btn btn-small btn-secondary" @click.stop="loadPalette(palette)">
                                        <i class="fas fa-edit"></i> Загрузить
                                    </button>
                                    <button class="btn btn-small btn-secondary" @click.stop="deletePalette(palette.id)">
                                        <i class="fas fa-trash"></i> Удалить
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div v-if="filteredPalettes.length === 0" style="text-align: center; padding: 40px; color: #666;">
                        <i class="fas fa-palette" style="font-size: 48px; margin-bottom: 20px;"></i>
                        <p>Палитры не найдены. Сохраните свою первую палитру!</p>
                    </div>
                </div>
            `
        };

        const ExportPage = {
            setup() {
                const exportFormat = ref('css');
                const generatedCode = ref('');
                
                const generateExportCode = () => {
                    const savedData = localStorage.getItem('colorPaletteData');
                    if (!savedData) return;
                    
                    const data = JSON.parse(savedData);
                    const colors = data.palette || [];
                    
                    switch (exportFormat.value) {
                        case 'css':
                            generatedCode.value = generateCssCode(colors);
                            break;
                        case 'scss':
                            generatedCode.value = generateScssCode(colors);
                            break;
                        case 'tailwind':
                            generatedCode.value = generateTailwindCode(colors);
                            break;
                        case 'json':
                            generatedCode.value = generateJsonCode(colors);
                            break;
                    }
                };
                
                const generateCssCode = (colors) => {
                    let code = ':root {\n';
                    colors.forEach((color, index) => {
                        code += `  --color-${index + 1}: ${color.hex};\n`;
                    });
                    code += '}\n\n/* Использование: */\n';
                    code += '.element {\n';
                    code += '  background-color: var(--color-1);\n';
                    code += '  color: var(--color-2);\n';
                    code += '}';
                    return code;
                };
                
                const generateScssCode = (colors) => {
                    let code = '// Цветовая палитра\n';
                    colors.forEach((color, index) => {
                        code += `$color-${index + 1}: ${color.hex};\n`;
                    });
                    code += '\n// Использование:\n';
                    code += '.element {\n';
                    code += '  background-color: $color-1;\n';
                    code += '  color: $color-2;\n';
                    code += '}';
                    return code;
                };
                
                const generateTailwindCode = (colors) => {
                    let code = '// tailwind.config.js\n';
                    code += 'module.exports = {\n';
                    code += '  theme: {\n';
                    code += '    extend: {\n';
                    code += '      colors: {\n';
                    code += '        palette: {\n';
                    colors.forEach((color, index) => {
                        code += `          ${index + 1}: '${color.hex}',\n`;
                    });
                    code += '        }\n';
                    code += '      }\n';
                    code += '    }\n';
                    code += '  }\n';
                    code += '}\n\n';
                    code += '/* Использование: bg-palette-1 text-palette-2 */';
                    return code;
                };
                
                const generateJsonCode = (colors) => {
                    const palette = colors.map(color => ({
                        hex: color.hex,
                        rgb: color.rgb,
                        hsl: color.hsl
                    }));
                    return JSON.stringify({ palette }, null, 2);
                };
                
                const copyCode = async () => {
                    try {
                        await navigator.clipboard.writeText(generatedCode.value);
                        alert('Код скопирован в буфер обмена!');
                    } catch (err) {
                        console.error('Ошибка копирования: ', err);
                    }
                };
                
                onMounted(() => {
                    generateExportCode();
                });
                
                watch(exportFormat, () => {
                    generateExportCode();
                });
                
                return {
                    exportFormat,
                    generatedCode,
                    generateExportCode,
                    copyCode
                };
            },
            template: `
                <div>
                    <h1 class="page-title">Экспорт палитры</h1>
                    
                    <div class="control-card">
                        <h2 class="card-title"><i class="fas fa-download"></i> Выберите формат экспорта</h2>
                        
                        <div class="export-options">
                            <div class="export-format" :class="{ active: exportFormat === 'css' }" 
                                 @click="exportFormat = 'css'">
                                <h3 style="margin-bottom: 8px;">CSS Variables</h3>
                                <p style="color: #666; font-size: 14px;">Современные CSS переменные для использования в проектах</p>
                            </div>
                            
                            <div class="export-format" :class="{ active: exportFormat === 'scss' }" 
                                 @click="exportFormat = 'scss'">
                                <h3 style="margin-bottom: 8px;">SCSS Variables</h3>
                                <p style="color: #666; font-size: 14px;">Переменные для препроцессора SCSS/Sass</p>
                            </div>
                            
                            <div class="export-format" :class="{ active: exportFormat === 'tailwind' }" 
                                 @click="exportFormat = 'tailwind'">
                                <h3 style="margin-bottom: 8px;">Tailwind Config</h3>
                                <p style="color: #666; font-size: 14px;">Конфигурация для фреймворка Tailwind CSS</p>
                            </div>
                            
                            <div class="export-format" :class="{ active: exportFormat === 'json' }" 
                                 @click="exportFormat = 'json'">
                                <h3 style="margin-bottom: 8px;">JSON</h3>
                                <p style="color: #666; font-size: 14px;">Универсальный JSON формат для любых целей</p>
                            </div>
                        </div>
                        
                        <div style="margin-top: 30px;">
                            <h3 style="margin-bottom: 15px;">Сгенерированный код:</h3>
                            <div class="code-block">
                                <pre>{{ generatedCode }}</pre>
                            </div>
                            <button class="btn btn-primary copy-code-btn" @click="copyCode">
                                <i class="fas fa-copy"></i> Скопировать код
                            </button>
                        </div>
                    </div>
                </div>
            `
        };

        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? 
                `rgb(${parseInt(result[1], 16)}, ${parseInt(result[2], 16)}, ${parseInt(result[3], 16)})` : 
                '';
        }

        // Настройка роутера
        const routes = [
            { path: '/', component: HomePage },
            { path: '/generator', component: GeneratorPage },
            { path: '/library', component: LibraryPage },
            { path: '/export', component: ExportPage }
        ];

        const router = createRouter({
            history: createWebHashHistory(),
            routes
        });

        const app = createApp({
            setup() {
                const darkTheme = ref(false);
                
                const toggleTheme = () => {
                    darkTheme.value = !darkTheme.value;
                    document.body.classList.toggle('light-theme');
                    document.body.classList.toggle('dark-theme');
                    localStorage.setItem('colorPaletteTheme', darkTheme.value ? 'dark' : 'light');
                };
                onMounted(() => {
                    const savedTheme = localStorage.getItem('colorPaletteTheme');
                    if (savedTheme === 'dark') {
                        darkTheme.value = true;
                        document.body.classList.remove('light-theme');
                        document.body.classList.add('dark-theme');
                    }
                });
                
                return {
                    darkTheme,
                    toggleTheme
                };
            }
        });

        app.use(router);
        app.mount('#app');
    </script>
</body>
</html>